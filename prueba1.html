<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArríbaTe | Propiedades en República Dominicana</title>
    <meta name="description"
        content="Arríbate, el mapa de propiedades en República Dominicana. Alquila, vende o encuentra propiedades con nuestra herramienta fácil de usar, mapa interactivo y atención personalizada. ¡Eleva tu búsqueda de propiedades con ARRIBATE!">
    <meta property="og:url" content="https://arribate.com" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ArríbaTe | Propiedades en República Dominicana" />
    <meta property="og:description"
        content="Arríbate, el mapa de propiedades en República Dominicana. Alquila, vende o encuentra propiedades con nuestra herramienta fácil de usar, mapa interactivo y atención personalizada. ¡Eleva tu búsqueda de propiedades con ARRIBATE!" />
    <meta property="og:image" content="https://arribate.com/img/og_image_1.jpg" />

    <link rel="icon" href="./img/icon_favicon_arribate.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" sizes="180x180" href="./img/icon_ios_180x180.png">
    <link rel="icon" href="./img/icon_arribate_32x32_circle.png" sizes="32x32" type="image/png">
    <link rel="icon" href="./img/icon_android_192x192.png" sizes="192x192" type="image/png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="./css/styles1.css" />
    <link rel="stylesheet" href="./css/stylefilter.css" />
    <link rel="stylesheet" href="./css/stylesmodal.css" />
    <link rel="stylesheet" href="./css/stylesmenu.css" />
    <link rel="stylesheet" href="./css/stylespublicate.css" />
    <link rel="stylesheet" href="./css/stylesterminos.css" />
</head>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-NMJVZCLFQV"></script>
<script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore-compat.js"></script>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBRjDso4IPrh9WLvWWMYoPiJxNFD6Vt3RU",
        authDomain: "arribate-com.firebaseapp.com",
        projectId: "arribate-com",
        storageBucket: "arribate-com.firebasestorage.app",
        messagingSenderId: "46945634270",
        appId: "1:46945634270:web:c74fd6781ac1fab5da7f4f",
        measurementId: "G-Y4J11MBYKQ"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);
</script>

<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-NMJVZCLFQV');
</script>
    

<body>

    <div class="boxmaster">


        <div class="menumaster">
            <!-- Menu Left -->
            <div class="menumaster-in-left">
                <div class="logonombre">
                    <div class="logo1"></div>
                    <div style="margin-left: 10px;">
                        <h1>ArríbaTe</h1>
                        <span>República Dominicana</span>
                    </div>
                </div>

                <div class="linediv"></div>

                <div class="botonbox">
                    <button id="ventaButton" class="toggle-button vibrar-button">Venta</button>
                    <button id="alquilerButton" class="toggle-button active vibrar-button">Alquiler</button>
                </div>



            </div>
            <!-- Menu Left FIN -->



            <!-- Menu respon -->
            <div class="botonbox2">

                <div>
                    <button id="ventaButton-rpsv" class="toggle-button vibrar-button">
                        <h3>Venta</h3>
                    </button>
                    <button id="alquilerButton-rpsv" class="toggle-button vibrar-button">
                        <h3>Alquiler</h3>
                    </button>
                </div>

                <div id="publicate-filter-rpsv" class="vibrar-button">
                    <div class="publicate-rpsv" class="vibrar-button">
                        <!-- <h3>Publíca<span style="color: #cd1025;">Te</span></h3> -->
                        <button id="open-publicate-respon" class="vibrar-button"></button> <!--  -------------   -->
                    </div>
                    <div class="cube-boton-filtro-respon"><button id="open-filter-button-respon" class="vibrar-button"></button></div>
                </div>
            </div>
            <!-- Menu respon FIN -->

            <div class="cube-boton-filtro"><button id="open-filter-button" class="vibrar-button">Filtros</button></div>

            <!-- Menu Right -->
            <div class="menumaster-in-right">
                <!-- <div class="cube-boton-filtro-respon"><button id="open-filter-button-respon"></button></div> -->
                <!-- Alquilar/vender -->

                <!-- <div class="Menu-contacto-redes-respon"></div> -->
                <div class="publicate">
                    <div class="publicate-In" id="open-publicate">Publíca<span style="color: #cd1025;">Te</span></div>
                    <!--  -------------   -->
                </div>

                <div class="linediv" style="margin: 0px 12px;"></div>
                <!-- Alquilar/vender FIN-->
                <!-- Redes -->
                <div class="redes-box">
                    <div class="redes-box-in">
                        <p>Síguenos:</p>
                        <div class="redes-buttones">
                            <div class="redes-button"><a href="https://www.instagram.com/arribate_oficial/" target="_blank"></a></div>
                            <div class="redes-button" style="background-image: url(./img/icons/facebook1.png);"><a href="https://www.facebook.com/profile.php?id=61567029011220&mibextid=ZbWKwL" target="_blank"></a></div>
                            <div class="redes-button" style="background-image: url(./img/icons/tiktok1.png);"><a href="https://www.tiktok.com/@arribate?_t=8qi2CSFx7or&_r=1" target="_blank"></a></div>
                        </div>
                    </div>
                </div>
                <!-- Redes FIN -->


                <!-- Menú new -->
                <div id="openBoxJmBtn" class="menu-all single-menu vibrar-button">
                    <div class="menu-lines">
                        <span class="line line1"></span>
                        <span class="line line2"></span>
                        <span class="line line3"></span>
                    </div>
                </div>

                <!-- Menú new FIN-->
            </div>
            <!-- Menu Right FIN -->

        </div>


        <!-- MAPA -->
        <div class="mapbox" style="position: fixed;top: 0px;left: 0px;">
            <div id="map" style="background: #aad3df;height: 100%;width: 100%;"></div>

            <button id="fullscreenButton" class="vibrar-button"></button>


            <!-- Botones capas, location -->
            <button id="changeLayerButton" class="layer-button vibrar-button">
                <img src="./img/capasatelite2.png" alt="Cambiar capa" id="layerIcon">
            </button>

            <button id="locateButton" class="vibrar-button"></button>

            <!-- Boton centrar en RD -->
            <button id="centerButton" class="center-button vibrar-button" style="display: none;">
            </button>
            <!-- Boton centrar en RD FIN -->
            <!-- Botones capas, location FIN -->

        </div>
    </div>
    <!-- MAPA Fin-->


    <!-- Modal -->
    <div id="propertyModal" class="modal">
        <div class="modal-content">
            <div class="modal-logo">
                <div class="modal-logo-in">
                    <img src="./img/logo2.png" alt="arribate">
                    <p>ARRIBA<span>TE</span></p>
                    <h1 style="position: absolute;
                    width: 1px;
                    height: 1px;
                    margin: -1px;
                    padding: 0;
                    border: 0;
                    clip: rect(0, 0, 0, 0);
                    overflow: hidden;">arribate</h1>
                </div>

            </div>
            <div class="modal-in">
                <!-- <h2>Información de la Propiedad</h2> -->




                <!-- Galeria -->
                <div class="gallery">
                    <div class="main-image">

                        <button class="nav-button-img-p left" id="prevMainImage">&#10094;</button>
                        <img id="currentImage" src="" alt="Imagen Principal">
                        <button class="nav-button-img-p right" id="nextMainImage">&#10095;</button>
                    </div>
                    <div class="thumbnails-container">
                        <button class="scroll-button left">&#10094;</button>

                        <div class="thumbnails"></div>

                        <button class="scroll-button right">&#10095;</button>
                    </div>
                </div>

                <div id="fullscreenView">
                    <button class="nav-button left" id="prevImage">&#10094;</button>
                    <div id="fullscreenImageContainer">
                        <img id="fullscreenImage" src="" alt="Imagen en pantalla completa">
                    </div>
                    <button class="nav-button right" id="nextImage">&#10095;</button>
                    <button id="closeFullscreen">Cerrar</button>
                </div>
                <!-- Galeria FIN -->



                <!-- Aquí se inyectará la información de CADA propiedad -->
                <div class="infocompleta">
                    <!-- Modal body -->
                    <div class="modal-body" id="modalPropertyDetails">

                    </div>



                    <!-- Modal para selección de aplicaciones de mapas IOS -->
                    <div id="modal-map-ios" class="modal-map-ios">
                        <div class="modal-map-ios-content">
                            <span class="close-modal-map-ios">&times;</span>
                            <h2>¿Con qué APP quieres abrir las coordenadas de esta propiedad?</h2>
                            <div>
                                <button id="appleMapsBtn"></button>
                                <button id="googleMapsBtn"></button>
                                <button id="wazeBtn"></button>
                                <button id="uberBtn"></button>
                            </div>
                        </div>
                    </div>
                    <!-- Modal para selección de aplicaciones de mapas IOS FIN -->

                    <!-- Modal body FIN -->

                </div>
                <!-- Aquí se inyectará la información de CADA propiedad FIN -->

            </div>

            <!-- Información general para todas las propiedades -->
            <div class="modal-end">
                <button id="comoLlegarButton" class="como-llegar-button" onclick="comoLlegarDesdeModal()"><img
                        src="./img/icons/location1.svg">
                    <div>
                        <h3>Cómo llegar</h3><span>a esta propiedad</span>
                    </div>
                </button>
                <div class="contactos-res">
                    <button><a href="#" id="whatsappButton" class="whatsapp-button" onclick="openWhatsApp()"
                            target="_blank"><img src="./img/icons/whatsapp2.svg">
                            <div><span>Para más información</span>
                                <h3>WhatsApp</h3>
                            </div>
                        </a>
                    </button></a>

                </div>

            </div>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <!-- Modal FIN -->



        <!-- Modal para imágenes en pantalla completa -->
        <div id="fullscreenModal" class="fullscreen-modal">
            <button class="close-fullscreen" onclick="closeFullscreenModal()">&times;</button>
            <img class="fullscreen-image" id="fullscreenModalImage" src="">
            <button class="nav-button left" id="prevFullscreenImage">&#10094;</button>
            <button class="nav-button right" id="nextFullscreenImage">&#10095;</button>
        </div>
        <!-- Modal para imágenes en pantalla completa FIN -->


    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>


    <!-- Filtros -->
    <div id="price-filter" class="filter">

        <div class="header-filter"><img src="./img/logo2.svg">
            <h1>Filtros</h1>
            <button id="close-filter-button" class="vibrar-button">X</button>
        </div>


        <div class="body-filter">
            <!-- Filtro de tipo de propiedad -->
            <h2>Tipos de propiedad</h2>
            <div class="filter-buttons">

                <button id="filter-house" class="filter-button active vibrar-button">
                    <img src="./img/casa4.png" alt="Casas">
                    <p>Casas</p>
                </button>
                <button id="filter-building" class="filter-button active vibrar-button">
                    <img src="./img/apartamento2.png" alt="Edificios" style="border-color: #52bae8;">
                    <p>Apartamentos</p>
                </button>
                <button id="filter-land" class="filter-button active vibrar-button">
                    <img src="./img/solar2.png" alt="Solares" style="border-color: #59a739;">
                    <p>Solares</p>
                </button>
            </div>
            <!-- Filtro de tipo de propiedad FIN-->

            <div class="filtro-divisor"></div>

            <!-- Filtro de Precios -->
            <h2>Rango de Precio</h2>

            <div class="price-labels">
                <div class="price-labels-cube">
                    <h6>Mínimo</h6>
                    <input type="text" id="min-price" placeholder="RD$0" readonly>
                </div>
                <h6 style="margin-block-start: 25px;color: #777777;">hasta</h6>
                <div class="price-labels-cube">
                    <h6>Máximo</h6>
                    <input type="text" id="max-price" placeholder="RD$0" readonly>
                </div>
            </div>

            <div class="range-slider">
                <div class="track"></div>
                <div class="range" id="range-highlight"></div>
                <input type="range" id="min-price-range" min="0" max="30000000" value="0">
                <input type="range" id="max-price-range" min="0" max="30000000" value="30000000">
            </div>

            <!-- Filtro de Precios fin -->

            <div class="filtro-divisor"></div>

            <!-- Filtro de cantidad -->
            <h2>Cantidades</h2>
            <div class="filtro-cantidad-cube">

                <div class="filter-counter">
                    <img src="./img/icons/habitacion1.svg">
                    <h6>Habitaciones</h6>
                    <div class="counter-cube">
                        <button id="decrease-rooms" class="vibrar-button">-</button>
                        <span id="rooms-count">Cualquiera</span>
                        <button id="increase-rooms" class="vibrar-button">+</button>
                    </div>
                </div>

                <div class="filter-counter">
                    <img src="./img/icons/baño2.svg">
                    <h6>Baños</h6>
                    <div class="counter-cube">
                        <button id="decrease-bathrooms" class="vibrar-button">-</button>
                        <span id="bathrooms-count">Cualquiera</span>
                        <button id="increase-bathrooms" class="vibrar-button">+</button>
                    </div>
                </div>

                <div class="filter-counter">
                    <img src="./img/icons/parqueo1.svg">
                    <h6>Parqueos</h6>
                    <div class="counter-cube">
                        <button id="decrease-parking" class="vibrar-button">-</button>
                        <span id="parking-count">Cualquiera</span>
                        <button id="increase-parking" class="vibrar-button">+</button>
                    </div>
                </div>
            </div>
            <!-- Filtro de cantidad FIN -->
        </div>


        <div class="footer-filter">

            <div class="toggle-buttons2">
                <button id="alquilerButton-filter" class="toggle-button active vibrar-button"><img src="./img/icons/refresh1.png">
                    <h3>Alquiler</h3>
                </button>
                <button id="ventaButton-filter" class="toggle-button vibrar-button"><img src="./img/icons/refresh1.png">
                    <h3>Venta</h3>
                </button>
            </div>

        </div>
        <!-- Filtros FIN -->


    </div>



    <!-- Cuadro BoxJM1 -->
    <div id="boxjm1" class="boxjm1">
        <div class="boxjm1-content">

            <div class="boxjm1-titulo">
                <p>Información</p>
                <span class="close2">&times;</span>
            </div>
            <div class="boxjm1-body">

                <nav>
                    <ul>
                        <li>
                            <h3>Conócenos:</h3>

                            <button data-seccion="sobre-nosotros" class="vibrar-button"><img src="./img/logo2.svg"><h5>Sobre nosotros</h5></button>

                        </li>
                        <li>
                            <h3>Contáctanos:</h3>
                            <button class="vibrar-button"><a href="tel:+18299605566"><img src="./img/icons/llamar1.png"><h5>+1 (829) 960-5566</h5></a></button>
                            <button class="vibrar-button"><a href="https://wa.me/18299605566?text=Hola,%20quisiera%20comunicarme%20con%20el%20servicio%20al%20cliente." target="_blank"><img src="./img/icons/servicio al cliente1.png"><h5>Servicio al cliente</h5></a></button>
                            <button class="vibrar-button"><a href="mailto:info@arribate.com"><img src="./img/icons/correo1.png"><h5>info@arribate.com</h5></a></button>
                        </li>
                        <li>
                            <h3>Siguénos:</h3>
                            <button class="vibrar-button" style="padding-right: 115px;"><a href="https://www.instagram.com/arribate_oficial/" target="_blank"><img src="./img/icons/instagram4.png"><h5>Instagram</h5></a></button>
                            <button class="vibrar-button" style="padding-right: 145px;"><a href="https://www.facebook.com/profile.php?id=61567029011220&mibextid=ZbWKwL" target="_blank"><img src="./img/icons/facebook4.png"><h5>Facebook</h5></a></button>
                            <button class="vibrar-button"><img src="./img/icons/tiktok4.png"><a href="https://www.tiktok.com/@arribate?_t=8qi2CSFx7or&_r=1" target="_blank"><h5>TikTok</h5></a></button>
                        </li>
                        <li>
                            <h3>Infórmate:</h3>
                            <button data-seccion="terminos-de-uso" class="vibrar-button"><img src="./img/icons/condiciones1.png"><h5>Condiciones de uso</h5></button>
                            <button data-seccion="politicas-de-privacidad" class="vibrar-button"><img src="./img/icons/privacidad1.png"><h5>Políticas de privacidad</h5></button>
                        </li>


                    </ul>
                </nav>


            </div>
            <div class="boxjm1-down">

                <div class="boxjm1-redes">
                    <h6> © ArríbaTe 2024 </h6>
                    <!-- <div><img src="./img/icons/instagram2.png"><img src="./img/icons/facebook2.png"><img
                            src="./img/icons/x2.png"></div> -->

                </div>
            </div>
        </div>
    </div>




    <script>



        // Ocultar la pantalla de carga y mostrar el contenido después de 2.7 segundos
        setTimeout(function () {
            document.querySelector('.loader').style.display = 'none';
            document.querySelector('.content').style.display = 'block';

        }, 2700);




        
        // Inicialización del mapa con un maxZoom aumentado
        var map;

        if (window.innerWidth <= 700) { // ajuste responsive
            map = L.map('map').setView([18.7357, -70.1627], 7);
        } else {
            map = L.map('map').setView([18.7357, -70.1627], 8);
        }

        // Capas de mapa
        var baseMaps = {
            "Claro": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map),
            "Vista Satelital": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
                maxZoom: 19
            })
        };

        // Referencia al botón de cambio de capa
        const changeLayerButton = document.getElementById('changeLayerButton');
        let isSatelliteView = false;  // Estado inicial

        changeLayerButton.addEventListener('click', () => {
            if (isSatelliteView) {
                // Cambiar a capa de mapa
                map.removeLayer(baseMaps["Vista Satelital"]);
                baseMaps["Claro"].addTo(map);
                changeLayerButton.querySelector('img').src = './img/capasatelite2.png'; // Cambiar imagen a satélite
                changeLayerButton.querySelector('img').alt = 'Cambiar a Satélite';
            } else {
                // Cambiar a capa satelital
                map.removeLayer(baseMaps["Claro"]);
                baseMaps["Vista Satelital"].addTo(map);
                changeLayerButton.querySelector('img').src = './img/capamapa2.png'; // Cambiar imagen a mapa
                changeLayerButton.querySelector('img').alt = 'Cambiar a Mapa';
            }
            isSatelliteView = !isSatelliteView; // Alternar estado
        });








        // Definir el ícono personalizado
        const customIcon = L.icon({
            iconUrl: './img/icons/location5.png', // Reemplaza con la ruta de tu imagen personalizada
            iconSize: [38, 38], // Tamaño del ícono [ancho, alto]
            iconAnchor: [19, 19], // Punto de anclaje en el centro del ícono
            className: 'custom-icon',
        });

        // Variables para almacenar el marcador y el círculo
        let userMarker;
        let userCircle;
        let tooltip;

        // Botón de mi ubicación
        const locateButton = document.getElementById('locateButton');

        // Evento click para centrar el mapa en la ubicación del usuario
        locateButton.addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    // Centrar el mapa en la ubicación del usuario
                    map.setView([lat, lng], 17);

                    // Si ya existe un marcador, elimínalo
                    if (userMarker) {
                        map.removeLayer(userMarker);
                    }

                    // Si ya existe un círculo, elimínalo
                    if (userCircle) {
                        map.removeLayer(userCircle);
                    }

                    // Agregar un marcador en la ubicación del usuario con el ícono personalizado
                    userMarker = L.marker([lat, lng], { icon: customIcon }).addTo(map);

                    // Agregar un círculo alrededor del marcador con un radio de 50 metros
                    userCircle = L.circle([lat, lng], {
                        color: '#ffffff00', // Color del borde del círculo
                        fillColor: 'rgb(0 142 255 / 0%)', // Color del interior del círculo (azul con opacidad)
                        fillOpacity: 1, // Opacidad del interior del círculo
                        radius: 350 // Radio en metros (50 metros)
                    }).addTo(map);

                    // Agregar un tooltip con el mensaje de ubicación estimada
                    tooltip = userMarker.bindTooltip("La ubicación es solo un estimado.", {
                        permanent: true, // Hace que el tooltip siempre esté visible
                        direction: 'top', // Coloca el tooltip encima del marcador
                        offset: [0, -25], // Ajusta la posición del tooltip con respecto al ícono
                        className: 'custom-tooltip' // Clase personalizada para el tooltip
                    }).openTooltip();

                    // Función para ocultar suavemente el tooltip
                    function hideTooltip() {
                        const tooltipElement = document.querySelector('.custom-tooltip');
                        if (tooltipElement) {
                            tooltipElement.style.transition = 'opacity 0.3s ease';
                            tooltipElement.style.opacity = '0'; // Desvanecer el tooltip
                            setTimeout(() => {
                                if (userMarker && tooltip) {
                                    userMarker.unbindTooltip(); // Eliminar el tooltip después de la animación
                                }
                            }, 300); // Tiempo de espera para la animación de 0.3s
                        }
                    }

                    // Ocultar el tooltip cuando el usuario haga clic en el mapa
                    map.on('click', hideTooltip);

                    // Ocultar el tooltip cuando el usuario arrastre el mapa
                    map.on('dragstart', hideTooltip);
                }, () => {
                    console.error("No se pudo obtener la ubicación.");
                });
            } else {
                console.error("La geolocalización no es soportada por este navegador.");
            }
        });




        // centrar
        const bounds = [
            [18.979026, -71.586914], //Oeste
            [18.29195, -70.19165], //Sureste
            [18.64104, -68.686523], //Este
            [19.733098, -70.587158]  //Norte
        ];

        const rectangle = L.rectangle(bounds, { color: "transparent", weight: 1 }).addTo(map);
map.fitBounds(bounds);

// Accede a la capa del rectángulo y establece el estilo
rectangle._path.style.pointerEvents = "none";

        map.on('moveend', function () {
            const centerButton = document.getElementById('centerButton');
            if (map.getBounds().intersects(bounds)) {
                centerButton.style.display = 'none';
            } else {
                centerButton.style.display = 'block';
            }
        });

        // Nivel de zoom por defecto
        let zoomLevel = 8;

        // Ajustar el nivel de zoom según el tamaño de la pantalla
        function adjustZoomLevel() {
            if (window.innerWidth <= 700) {
                zoomLevel = 7;
            } else {
                zoomLevel = 8;
            }
        }

        // Llamar a la función al cargar la página y al cambiar el tamaño de la ventana
        adjustZoomLevel();
        window.addEventListener('resize', adjustZoomLevel);

        document.getElementById('centerButton').addEventListener('click', function () {
            map.flyToBounds(bounds, {
                duration: 1,
                maxZoom: zoomLevel
            });
        });
        // centrar Fin



        // Función para formatear números con comas como separadores de miles
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

       // Variables de iconos
var houseIcon = './img/casa4.png';
var buildingIcon = './img/apartamento2.png';
var landIcon = './img/solar2.png';

// Función para obtener el ícono directamente desde el valor almacenado en Firebase
function getIconFromFirebase(iconKey) {
    switch (iconKey) {
        case "houseIcon":
            return houseIcon;
        case "buildingIcon":
            return buildingIcon;
        case "landIcon":
            return landIcon;
        default:
            console.warn(`Valor de ícono desconocido en Firebase: ${iconKey}`);
            return houseIcon; // Ícono por defecto
    }
}

        // Función para obtener el color del fondo del span según el tipo de propiedad
        function getBackgroundColor(iconUrl) {
            if (iconUrl === houseIcon) {
                return '#ff5f64'; // Color para casas
            } else if (iconUrl === buildingIcon) {
                return '#1090e7'; // Color para apartamentos
            } else if (iconUrl === landIcon) {
                return '#59a739'; // Color para solares
            } else {
                return 'white'; // Color por defecto
            }
        }


        // Creación de íconos personalizados con precio y color según el tipo de propiedad
        function createIcon(iconUrl, price, isAlquiler) {
            var backgroundColor = getBackgroundColor(iconUrl); // Obtener color de fondo
            // Si es un alquiler, añade "/mes" al final del precio
            var priceText = `RD$${formatNumber(price)}` + (isAlquiler ? "/mes" : "");

            return L.divIcon({
                html: `<div style="position: relative; display: flex; flex-direction: column; align-items: center;">
            <img src="${iconUrl}" style="margin-top: -26px;
            width: 32px; height: 32px; background: #0f1931; border-radius: 31px; border-style: solid; border-color: ${backgroundColor}; border-width: 3px;" />
            <span style="background: ${backgroundColor}; 
            font-family: system-ui;color: white;font-size: 12px;font-weight: bold;
            padding: 2px 4px; border-radius: 3px; margin-top: -8px;">${priceText}</span>
            <div class="price-tip" style="border-top-color: ${backgroundColor};"></div>
        </div>`,
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32]
            });
        }

        // Íconos para referencia
        var roomIcon = './img/icons/habitacion1.svg'; // ícono para habitaciones
        var bathroomIcon = './img/icons/baño1.svg'; // ícono para baños
        var parkingIcon = './img/icons/parqueo1.svg'; // ícono para parqueo
        var areaIcon = './img/icons/area1.svg'; // ícono para área

        // Normalización de ubicaciones
        function normalizeLocation(location) {
            return location.latLng ? { ...location, lat: location.latLng[0], lng: location.latLng[1] } : location;
        }


//firebase
     // Definición de ubicaciones con información adicional
        var alquileres = [];

        var ventas = [];

// Función para obtener propiedades de Firestore
async function obtenerPropiedadesDeFirestore() {
    const alquileresFirestore = [];
    const ventasFirestore = [];
    
    // Obtener propiedades de alquiler
    const alquileresSnapshot = await db.collection('alquileres').get();
    alquileresSnapshot.forEach(doc => {
        const data = doc.data();
        // Convertir latLng de string a array
        const latLng = data.latLng.split(',').map(Number);
        alquileresFirestore.push({
            id: data.id,
            latLng: latLng,
            title: data.title,
            price: data.price,
            icon: getIconFromFirebase(data.icon), // Obtener el ícono directamente desde Firebase
            rooms: data.rooms,
            bathrooms: data.bathrooms,
            parking: data.parking,
            area: data.area,
            imageFolder: data.imageFolder,
            imageCount: data.imageCount,
            caracteristicas: data.caracteristicas
        });
    });

    // Obtener propiedades de venta
    const ventasSnapshot = await db.collection('ventas').get();
    ventasSnapshot.forEach(doc => {
        const data = doc.data();
        const latLng = data.latLng.split(',').map(Number);
        ventasFirestore.push({
            id: data.id,
            latLng: latLng,
            title: data.title,
            price: data.price,
            icon: getIconFromFirebase(data.icon), // Obtener el ícono directamente desde Firebase
            rooms: data.rooms,
            bathrooms: data.bathrooms,
            parking: data.parking,
            area: data.area,
            imageFolder: data.imageFolder,
            imageCount: data.imageCount,
            caracteristicas: data.caracteristicas
        });
    });

    // Combinar datos locales con datos de Firestore
    alquileres = [...alquileres, ...alquileresFirestore];
    ventas = [...ventas, ...ventasFirestore];

    // Crear marcadores después de obtener los datos
    createMarkers(alquileres, alquilerMarkers);
    createMarkers(ventas, ventaMarkers);
}

// Llamar a la función para obtener propiedades
obtenerPropiedadesDeFirestore().then(() => {
    // Inicializar los marcadores después de que se hayan obtenido los datos
    toggleMarkers('venta'); // O 'alquiler' dependiendo de lo que quieras mostrar inicialmente
});
//firebase FIN


// Carousel

// Función para crear el carrusel
function createCarousel(id, imageCount) {
    let carousel = `<div class="carousel">
                    <div class="botonmaximizar"></div>
                    <div class="carousel-inner">`;

    const maxImagesToShow = Math.min(imageCount, 7); // Limitar a un máximo de 7 imágenes

    for (let i = 1; i <= maxImagesToShow; i++) {
        const imgSrc = `https://firebasestorage.googleapis.com/v0/b/arribate-com.firebasestorage.app/o/propiedades%2F${id}%2Fimg%2F${i}.jpg?alt=media`; // Usa id aquí
        carousel += `
            <div class="placeholder" style="background-color: #f0f0f0;"> 
                <img src="${imgSrc}" class="${i === 1 ? 'active' : ''}" alt="Imagen ${i}" loading="lazy" onload="this.parentNode.style.backgroundImage = 'none'"> 
            </div>`; 
    }
    carousel += `
                    </div>
                    <button class="prev">❮</button>
                    <button class="next">❯</button>
                    <div class="indicators">
                      ${Array.from({ length: maxImagesToShow }, (_, index) => `<span class="indicator ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`).join('')}
                    </div>
                  </div>`;
    return carousel;
}

        // Función para cambiar la imagen
        function changeImage(carousel, direction) {
            const carouselInner = carousel.querySelector('.carousel-inner');
            const images = carousel.querySelectorAll('.carousel-inner img');
            const indicators = carousel.querySelectorAll('.indicator');
            let currentIndex = Array.from(images).findIndex(img => img.classList.contains('active'));

            // Calcular el nuevo índice
            let newIndex = currentIndex + direction;
            if (newIndex < 0) {
                newIndex = images.length - 1;
            } else if (newIndex >= images.length) {
                newIndex = 0;
            }

            // Actualizar clases 'active'
            images[currentIndex].classList.remove('active');
            indicators[currentIndex].classList.remove('active');
            images[newIndex].classList.add('active');
            indicators[newIndex].classList.add('active');

            // Mover el carousel-inner
            const imageWidth = images[0].offsetWidth;
            const newPosition = -newIndex * imageWidth;
            carouselInner.style.transform = `translateX(${newPosition}px)`;
        }

        // Función para establecer la imagen activa al hacer clic en un indicador
        function setActiveImage(carousel, index) {
            const carouselInner = carousel.querySelector('.carousel-inner');
            const images = carousel.querySelectorAll('.carousel-inner img');
            const indicators = carousel.querySelectorAll('.indicator');
            const currentIndex = Array.from(images).findIndex(img => img.classList.contains('active'));

            if (currentIndex === index) return; // Si ya está activo, no hacer nada

            // Actualizar clases 'active'
            images[currentIndex].classList.remove('active');
            indicators[currentIndex].classList.remove('active');
            images[index].classList.add('active');
            indicators[index].classList.add('active');

            // Mover el carousel-inner
            const imageWidth = images[0].offsetWidth;
            const newPosition = -index * imageWidth;
            carouselInner.style.transform = `translateX(${newPosition}px)`;
        }

        // Funciones para manejar el evento touch
        function addTouchEvents(carousel) {
            let touchStartX = 0;
            let touchEndX = 0;
            const threshold = 50; // Umbral de deslizamiento en píxeles

            carousel.addEventListener('touchstart', function (event) {
                touchStartX = event.changedTouches[0].clientX;
            }, false);

            carousel.addEventListener('touchend', function (event) {
                touchEndX = event.changedTouches[0].clientX;
                handleGesture();
            }, false);

            function handleGesture() {
                const deltaX = touchEndX - touchStartX;
                if (Math.abs(deltaX) > threshold) {
                    if (deltaX > 0) {
                        // Deslizamiento hacia la derecha -> Imagen anterior
                        changeImage(carousel, -1);
                    } else {
                        // Deslizamiento hacia la izquierda -> Siguiente imagen
                        changeImage(carousel, 1);
                    }
                }
            }
        }

        

        // Añadimos los event listeners a cada carrusel después de crearlo
        function initializeCarouselEvents() {
    const carousels = document.querySelectorAll('.carousel');

    carousels.forEach(carousel => {
        const prevButton = carousel.querySelector('.prev');
        const nextButton = carousel.querySelector('.next');
        const indicators = carousel.querySelectorAll('.indicator');

        prevButton.addEventListener('click', () => changeImage(carousel, -1));
        nextButton.addEventListener('click', () => changeImage(carousel, 1));

        indicators.forEach(indicator => {
            indicator.addEventListener('click', () => {
                const index = parseInt(indicator.getAttribute('data-index'));
                setActiveImage(carousel, index);
            });
        });

        // Añadir eventos táctiles
        addTouchEvents(carousel);
    });
}

// Crear marcadores y popups con carruseles
function createMarkers(locations, markersArray) {
    locations.forEach(function (location) {
        location = normalizeLocation(location);
        var isAlquiler = markersArray === alquilerMarkers;  // Verifica si es alquiler
        var marker = L.marker([location.lat, location.lng], { icon: createIcon(location.icon, location.price, isAlquiler) });

        // Crear el carrusel usando el id de la propiedad
        var carousel = location.imageCount ? createCarousel(location.id, location.imageCount) : '';

        // Agregar condicionalmente "/mes" al precio si es un alquiler
        var priceText = `RD$ ${formatNumber(location.price)}`;
        if (markersArray === alquilerMarkers) {
            priceText += '/mes';
        }

        marker.bindPopup(
            `<button id="vermodal" onclick="openModal(${JSON.stringify(location).replace(/"/g, '&quot;')})"></button>
            <button onclick="openModal(${JSON.stringify(location).replace(/"/g, '&quot;')}) "style="position: absolute;top: 130px;right: 0px;height: 60px;width: 60px;z-index: 9;border: none;background: #00000000;cursor: pointer;"></button>
            ${carousel}
            <div class="informacion-basica"> 
                <button id="btncomollegar" onclick="comoLlegar(${location.lat}, ${location.lng})"><img src="./img/icons/location1.svg">Cómo llegar</button>
                <span class="price-text">${priceText}</span><br>
                <div class="titulos-propiedad-pop"><b>${location.title}</b><br></div>
                <div class="detalles-basicos"> 
                    <img src="${roomIcon}" style="width: 26px; height: 26px;"/> ${location.rooms}
                    <img src="${bathroomIcon}" style="width: 26px; height: 26px; margin-left: 10px;"/> ${location.bathrooms}
                    <img src="${parkingIcon}" style="width: 26px; height: 26px; margin-left: 10px;"/> ${location.parking}
                    <img src="${areaIcon}" style="width: 26px; height: 26px; margin-left: 10px;"/> ${location.area} m²
                </div>
            </div>`
        ).addTo(map).on('popupopen', function () {
            // Inicializar eventos del carrusel en el popup
            initializeCarouselEvents();
        });

        markersArray.push(marker);
    });
}

        // Función de cómo llegar
        function comoLlegar(lat, lng) {
            var url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
            window.open(url, '_blank');
        }
        // PopUP FIN



        function comoLlegarDesdeModal() {
            // Obtener latitud y longitud de la propiedad actualmente mostrada en el modal
            const propertyId = parseInt(window.location.hash.substring('#id-'.length));
            const property = [...alquileres, ...ventas].find(p => p.id === propertyId);

            if (property) {
                const lat = property.latLng ? property.latLng[0] : property.lat;
                const lng = property.latLng ? property.latLng[1] : property.lng;

                // Verificar si estamos en un dispositivo iOS
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

                if (isIOS) {
                    // Crear enlaces personalizados para cada aplicación en iOS
                    const appleMapsUrl = `maps://?q=${lat},${lng}`;
                    const googleMapsUrl = `comgooglemaps://?q=${lat},${lng}&center=${lat},${lng}`;
                    const wazeUrl = `waze://?ll=${lat},${lng}&navigate=yes`;
                    const uberUrl = `uber://?action=setPickup&dropoff[latitude]=${lat}&dropoff[longitude]=${lng}`;

                    // Función para intentar abrir la URL y mostrar un mensaje si no está instalada
                    function tryOpenUrl(url, fallbackMessage) {
                        const timeout = setTimeout(() => {
                            alert(fallbackMessage); // Mostrar el mensaje personalizado
                        }, 1500); // 1.5 segundos de espera

                        window.location.href = url;

                        window.addEventListener('blur', () => {
                            clearTimeout(timeout); // Si la app se abre, cancelar el timeout
                        });
                    }

                    // Mostrar el modal
                    const modal = document.getElementById('modal-map-ios');
                    modal.style.display = 'block';

                    // Obtener los botones y asociar las URLs con la función tryOpenUrl
                    document.getElementById('appleMapsBtn').onclick = function () {
                        tryOpenUrl(appleMapsUrl, 'Apple Maps no está instalada en este dispositivo.');
                    };
                    document.getElementById('googleMapsBtn').onclick = function () {
                        tryOpenUrl(googleMapsUrl, 'Google Maps no está instalada en este dispositivo.');
                    };
                    document.getElementById('wazeBtn').onclick = function () {
                        tryOpenUrl(wazeUrl, 'Waze no está instalada en este dispositivo.');
                    };
                    document.getElementById('uberBtn').onclick = function () {
                        tryOpenUrl(uberUrl, 'Uber no está instalada en este dispositivo.');
                    };

                    // Cerrar el modal cuando se hace clic en la "X"
                    document.querySelector('.close-modal-map-ios').onclick = function () {
                        modal.style.display = 'none';
                    };

                    // Cerrar el modal si el usuario hace clic fuera del contenido del modal
                    window.onclick = function (event) {
                        if (event.target == modal) {
                            modal.style.display = 'none';
                        }
                    };
                } else {
                    // Para Android, usar geo URI scheme
                    const url = `geo:${lat},${lng}?q=${lat},${lng}`;
                    window.location.href = url;
                }
            } else {
                console.error("No se pudo encontrar la propiedad para obtener las coordenadas.");
            }
        }




        //boton compartir
        function shareProperty() {
            const propertyId = parseInt(window.location.hash.substring('#id-'.length));
            const propertyLink = `https://arribate.com/#id-${propertyId}`; // Asegúrate de reemplazar 'tusitioweb.com' con tu dominio real
            const message = `¡Mira esta propiedad en ArríbaTe!`;

            if (navigator.share) { // Verificar si la API Web Share está disponible
                navigator.share({
                    title: 'Compartir Propiedad',
                    text: message,
                    url: propertyLink
                })
                    .then(() => console.log('Contenido compartido exitosamente'))
                    .catch(error => console.error('Error al compartir:', error));
            } else {
                // Si la API Web Share no está disponible, puedes copiar el enlace al portapapeles o mostrar un mensaje
                alert("La función de compartir no está disponible en este navegador. Puedes copiar el enlace manualmente.");
                // Código para copiar al portapapeles (opcional):
                // const tempInput = document.createElement('input');
                // tempInput.value = propertyLink;
                // document.body.appendChild(tempInput);
                // tempInput.select();
                // document.execCommand('copy');
                // document.body.removeChild(tempInput);
            }
        }









        var alquilerMarkers = [];
        var ventaMarkers = [];

        createMarkers(alquileres, alquilerMarkers);
        createMarkers(ventas, ventaMarkers);

        // Variable para mantener el tipo activo
        var activeType = 'alquiler';

        // Funciones para mostrar/ocultar marcadores
        function toggleMarkers(type) {
            activeType = type; // Actualizar el tipo activo

            var showMarkers = type === 'alquiler' ? alquilerMarkers : ventaMarkers;
            var hideMarkers = type === 'alquiler' ? ventaMarkers : alquilerMarkers;

            showMarkers.forEach(marker => marker.addTo(map));
            hideMarkers.forEach(marker => map.removeLayer(marker));

            filterMarkers(); // Filtrar los marcadores después de cambiar el tipo
        }




        // Botones alquiler-venta con su .active
        const buttonGroups = {
            alquiler: ['alquilerButton', 'alquilerButton-filter', 'alquilerButton-rpsv'],
            venta: ['ventaButton', 'ventaButton-filter', 'ventaButton-rpsv']
        };

        function activateGroup(group) {
            for (const buttonId in buttonGroups) {
                const buttons = buttonGroups[buttonId];
                buttons.forEach(id => {
                    const button = document.getElementById(id);
                    if (buttonId === group) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
            }
            toggleMarkers(group);
        }

        // Event listeners para todos los botones
        for (const group in buttonGroups) {
            buttonGroups[group].forEach(id => {
                document.getElementById(id).addEventListener('click', () => activateGroup(group));
            });
        }

        // Asegurar que 'alquilerButton-rpsv' esté activo al cargar la página
        activateGroup('venta');

        // Botones alquiler-venta con su .active FIN



        // Inicialmente mostrar solo los alquileres
        toggleMarkers('venta');
    </script>

    <script>
        // Función para detectar si el dispositivo es iOS
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        const fullscreenButton = document.getElementById('fullscreenButton');

        // Ocultar el botón de pantalla completa si es iOS
        if (isIOS()) {
            fullscreenButton.style.display = 'none'; // Oculta el botón
        } else {
            fullscreenButton.addEventListener('click', () => {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                } else {
                    document.documentElement.requestFullscreen();
                }
            });

            // Evento para detectar cambios en el estado de pantalla completa
            document.addEventListener('fullscreenchange', () => {
                if (document.fullscreenElement) {
                    fullscreenButton.classList.add('active'); // Agregar clase 'active'
                } else {
                    fullscreenButton.classList.remove('active'); // Quitar clase 'active'
                }
            });
        }
    </script>

    <script src="./js/scriptfiltros.js"></script>
    <script src="./js/scriptmodal.js"></script>
    <script src="./js/scriptmenu.js"></script>
    <script src="./js/scriptpublicate.js"></script>
    <script src="./js/scriptterminos.js"></script>



</body>

</html>
